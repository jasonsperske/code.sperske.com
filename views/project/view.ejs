<div class="grid-container">
  <div class="nav">
    <%=project.name%>
  </div>
  <div class="footer"></div>
  <div class="content">
    <div class="tree">
    <% function renderDirectory(dir, base='') { %>
      <ul>
        <%dir.children.forEach((child) => {%>
          <%const isDirectory = child.type === 'directory';%>
          <% if (isDirectory) { %>
            <li class="directory">
          <% } else { %>
            <li data-source-path="<%=base%><%=child.name%>">
          <% } %>
            <%=child.name%>
            <% if (isDirectory) { %>
              <%-renderDirectory(child, `${base}${child.name}/`)-%>
            <% } %>
          </li>
        <%})%>
      </ul>
    <% } %>
    <ul style="padding: 0">
      <li class="directory">
        <%=project.name%>
        <%-renderDirectory(project)-%>
      </li>
    </ul>
    </div>
    <div class="content_seperator"></div>
    <div class="code_pane">
      <div class="code"><div id="editor"></div></div>
      <div class="code_pane_seperator"></div>
      <div class="output"><iframe id="output"></iframe></div>
    </div>
  </div>
</div>
<script type="text/javascript">
  const editor = ace.edit('editor');
  const tree = [...document.getElementsByClassName("tree")].shift();
  tree.addEventListener('click', (e) => {
    if (e.target.nodeName === 'LI' && e.target.dataset.sourcePath) {
      fetch('/project/<%=project.name%>/source/'+e.target.dataset.sourcePath)
        .then(res => res.json())
        .then((data) => {
          editor.session.setValue(data.source);
          editor.session.setMode('ace/mode/' + data.type.ace.mode);
        });
    }
  }, false);
  editor.session.setMode('ace/mode/text');
</script>
